<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://jorgego11.github.io/aiopslabs/integration/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Start Here - Watson AIOps</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Start Here";
        var mkdocs_page_input_path = "integration.md";
        var mkdocs_page_url = "/aiopslabs/integration/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Watson AIOps
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Start Here</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#lab-overview">Lab Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#lab-terms-definition">Lab Terms Definition</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#connecting-to-the-cp4waiops-console">Connecting to the CP4WAIOps console</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configure-the-efk-integration">Configure the EFK Integration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configure-the-instana-integration">Configure the Instana Integration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#review-and-update-cp4waiops-policies">Review and Update CP4WAIOps Policies</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../log-anomaly/">Log Anomaly Training</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../inference/">Inference Results</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../about/">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Watson AIOps</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>Start Here</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="welcome-to-the-cloud-pack-for-watson-aiops-v33-lab">Welcome to the Cloud Pack for Watson AIOps v3.3 Lab</h1>
<p>For the complete product documentation, visit <a href="https://www.ibm.com/docs/en/cloud-paks/cloud-pak-watson-aiops/3.3.1">this link</a>.</p>
<h2 id="lab-overview">Lab Overview</h2>
<p>In this Lab, you will play the role of an IT Operations expert that will configure the Cloud Pack for Watson AIOps (CP4WAIOps) to support IT Operations of a sample business application called QOTD. This application is being "observed" by Instana to pull application performance management metrics including topology. The application logs are being collected by a ElasticSearch (ELK) based log aggregator. These logs are consumed by CP4WAIOps to create a Log Anomaly model. And this model is used to detect application anomalies that will be shown in an incident Story. </p>
<p>These are the different Lab steps:</p>
<ol>
<li>Configure the EFK Integration in CP4WAIOps to pull business application logs</li>
<li>Configure the Instana Integration in CP4WAIOps to pull business application topology</li>
<li>Update CP4WAIOps Policies to create stories</li>
<li>Configure CP4WAIOps Log Anomaly Training</li>
<li>Configure CP4WAIOps Log Anomaly Inference</li>
<li>Verify CP4WAIOps incident stories</li>
</ol>
<p><strong>NOTE:</strong> The Lab has configuration parameters that you should copy/paste from the tables shown in this <a href="https://ibm.box.com/s/vt86do910u7qsw9lgvfugg7rjje6bcuw">web page</a>
The Lab call these as <em>Lab Parameters Table</em>. Make sure you copy the full parameter value and not miss any characters. </p>
<p>The following deployment architecture shows the different components that support the Lab:</p>
<p><img alt="Lab Overview" src="../images/lab-overview.png" title="Lab Overview" /></p>
<hr />
<h2 id="lab-terms-definition">Lab Terms Definition</h2>
<p>Lets define some key CP4WAIOps concepts and terms that will help you understand the Lab:</p>
<p><strong>Events:</strong> An event is a record containing structured data summarizing key attributes of an occurrence on a managed entity, which might be a network resource, some part of that resource, or other key element associated with your network, services, or applications. An event may or may not indicate something anomalous and is a point-in-time, immutable statement about the managed entity in question.</p>
<p><strong>Alerts:</strong> Alerts are created when one or more <strong>events</strong> indicate an anomalous condition. Alerts represent an ongoing anomalous condition against a single managed entity. Unlike events, alerts might evolve over time as the condition changes. Alerts have a start and an end time. The creation and evolution of alerts are informed by events. CP4WAIOps automatically correlates alerts to determine what alerts are likely to share a common cause. This is determined based on a combination of:</p>
<ul>
<li>
<p><strong>Scope-based correlation</strong> - Any alerts which have the same value for the resource field are correlated.</p>
</li>
<li>
<p><strong>Temporal correlation</strong> - The system continually analyzes past alerts to determine which alerts tend to frequently co-occur. When these alerts occur together again, they are correlated.</p>
</li>
<li>
<p><strong>Topological correlation</strong> - Any alerts which refer to resources within the same Resource group are correlated.</p>
</li>
</ul>
<p><strong>Stories:</strong> Stories represent the context around an incident which is currently severely impacting IT Operations. This includes all alerts that are related to the incident and information about how the affected resources are related. The creation and evolution of stories are informed by <strong>alerts</strong>. Stories can help build the understanding of the current situation and also drive the remediation steps. In other words, stories represent an <code>IT Operations incident</code> and are categorized by priority from 1 (high) to 5 (low).</p>
<p><strong>Policies:</strong> Policies are rules that contain a condition and a set of actions that can be manual or automated. They can be triggered to automatically promote events to alerts, reduce noise by grouping alerts into a story, and assign runbooks to remediate alerts. Each policy has an execution priority number which is determines which policy runs first. </p>
<p><strong>Runbooks:</strong> A runbook is a controlled set of automated and manual steps that support system and network operational processes. A runbook orchestrates all types of infrastructure elements, such as applications, network components, or servers. We can also use runbooks to document standard procedures that can be leveraged by IT operations.</p>
<p><strong>Actions:</strong> Actions are the collection of several predefined steps into a single automated tested entity that can be shared by multiple runbooks. Actions improve runbook efficiency by encapsulating procedures and operations. </p>
<hr />
<h2 id="connecting-to-the-cp4waiops-console">Connecting to the CP4WAIOps console</h2>
<p>Lets start by connecting to the CP4WAIOps console. Get the URL and login credentials from the <em>Lab Parameters Table</em>. You will see the console home page as shown below. </p>
<p><img alt="Home Page" src="../images/home-page.png" title="Home Page" /></p>
<hr />
<h2 id="configure-the-efk-integration">Configure the EFK Integration</h2>
<p>EFK is a variant of ELK (Elasticsearch, Logstash, and Kibana). EFK is a suite of tools combining Elasticsearch, Fluentd, and Kibana that functions as a log aggregation tool. To simplify the installation and configuration effort for installing the different components of the EFK stack on OpenShift, we leverage the <code>OpenShift Logging</code> library from OpenShift. OpenShift customers that prefer not to spend part of their budget on a commercial log aggregator such as Humio, Splunk, or LogDNA, more than likely use the <code>OpenShift Logging</code> library.</p>
<p>To have AI Manager collect logs from the EFK installation that leverages the <code>OpenShift Logging</code> library, you need to define an EFK integration. The lab will provide the values that you should use for defining the EFK integration.</p>
<p>From the Home page, under <code>Overview</code> clik on <code>Data and tool connections</code> on the left side of the page. Click on the <code>Add connection</code> button on the top right. On the ELK card, select <code>Add connection</code>. Take a moment to read the connection overview on the right side slider, then click on <code>Connect</code>, as shown in the following screen.</p>
<p><img alt="elk integration 1" src="../images/elk-integration-1.png" title="ELK integration 1" /></p>
<p>Complete the ELK, <code>Add connection</code> form, with the following values:</p>
<ul>
<li>
<p><code>Name</code>: Name of the ELK integration, for example <code>EFK for QOTD</code>.</p>
</li>
<li>
<p><code>Description</code>: Leave it blank.</p>
</li>
<li>
<p><code>ELK service URL</code>: Get the service URL for the EFK installation from the <em>Lab Parameters Table</em>.</p>
</li>
<li>
<p><code>Kibana URL</code>: Get URL for Kibana from the <em>Lab Parameters Table</em>.</p>
</li>
<li>
<p><code>Authentication type</code>: Set this value to <code>Token</code>.</p>
</li>
<li>
<p><code>Token</code>: Get the token from the <em>Lab Parameters Table</em>.</p>
</li>
<li>
<p><code>Certificate</code>: Leave it blank.</p>
</li>
<li>
<p><code>Filters</code>: Don't change it.</p>
</li>
<li>
<p><code>Time zone</code>: Don't change it.</p>
</li>
<li>
<p><code>Kibana port</code>: Type <code>443</code>.</p>
</li>
<li>
<p><code>Base parallelism</code>: Don't change it.</p>
</li>
<li>
<p><code>Sampling rate</code>: Don't change it.</p>
</li>
</ul>
<p>Click on the <code>Next</code> button.</p>
<ul>
<li><code>Field mapping</code>: Use the mapping shown below instead of the default mapping provided on the ELK integration. Make sure you see the <code>Valid JSON configuration</code> message after that:</li>
</ul>
<pre><code>{
    &quot;codec&quot;: &quot;elk&quot;,
    &quot;message_field&quot;: &quot;message&quot;,
    &quot;log_entity_types&quot;: &quot;kubernetes.container_image_id, kubernetes.host, kubernetes.pod_name, kubernetes.namespace_name&quot;,
    &quot;instance_id_field&quot;: &quot;kubernetes.container_name&quot;,
    &quot;rolling_time&quot;: 10,
    &quot;timestamp_field&quot;: &quot;@timestamp&quot;
}
</code></pre>
<ul>
<li>Click on the <code>Test Connection</code> button and confirm you get <em>Test Succeded</em> </li>
</ul>
<p>Click on the <code>Next</code> button.</p>
<ul>
<li>
<p><code>Data flow</code>: Turn this on. </p>
</li>
<li>
<p><code>Mode</code>: Select the <code>Historical data for initial AI training</code> option using the dates listed below. CP4WAIOps will ingest one day of historical application log data (stored in the log aggregator) that we know in advanced that can be used as a "reference" for a normal day because no major IT incident happen. We will use this data later for Log Anomaly training. </p>
<ul>
<li>Start date: May 8, 2022</li>
<li>End Date: May 8, 2022</li>
</ul>
</li>
<li>
<p><code>Source parallelism (1-50)</code>: Don't change it.</p>
</li>
</ul>
<p>The following screenshots show the form update flow as guidance <strong>(note that config values may be different in the screenshots, follow the previous instructions instead)</strong></p>
<p><img alt="elk integration 2" src="../images/elk-integration-2.png" title="ELK integration 2" /></p>
<p><img alt="elk integration 3" src="../images/elk-integration-3.png" title="ELK integration 3" /></p>
<p><img alt="elk integration 4" src="../images/elk-integration-4.png" title="ELK integration 4" /></p>
<p><img alt="elk integration 5" src="../images/elk-integration-5.png" title="ELK integration 5" /></p>
<p><img alt="elk integration 6" src="../images/elk-integration-6.png" title="ELK integration 6" /></p>
<p>Finally, click on the <code>Done</code> button.  After some time, you will see the message <code>Connection completed. IBM Cloud Pak for Watson AIOps has successfully processed your request</code> and the ELK integration page will show the Data Flow Status as <code>Running</code> as shown below:</p>
<p><img alt="elk integration 7" src="../images/elk-integration-7.png" title="ELK integration 7" /></p>
<p>After around 15 minutes, it will stop pulling the data and the Data Flow Status will change to <code>Finished</code> as shown below. <strong>Don't wait. Move to the next step in the meantime.</strong></p>
<p><img alt="elk integration 8" src="../images/elk-integration-8.png" title="ELK integration 8" /></p>
<hr />
<h2 id="configure-the-instana-integration">Configure the Instana Integration</h2>
<p>The CP4WAIOps will consume topology information from Instana therefore we will configure the integration between the CP4WAIOps and Instana.</p>
<p>Lets verify first that there is no topology data in the system. From the Home page, clik on <code>Resource management</code> under <code>Overview</code> on the left side of the page. On the Resource management page, make sure there are no Applications, Resource groups nor Resources defined, as shown below</p>
<p><img alt="instana integration 0" src="../images/instana-0.png" title="Instana integration 0" /></p>
<p>Now, lets define the Instana integration. From the Home page, clik on <code>Data and tool connections</code> under <code>Overview</code> on the left side of the page. Click on the <code>Add connection</code> button on the top right. On the Instana card, select <code>Add connection</code>. Take a moment to read the connection overview on the right side slider, then click on <code>Connect</code>, as shown in the following screen.</p>
<p><img alt="instana integration 1" src="../images/instana-1.png" title="Instana integration 1" /></p>
<p>Enter the following <code>Add connection</code> information:</p>
<ul>
<li>
<p><code>Name</code>: The display name of your connection, for example <code>Instana connection</code>.</p>
</li>
<li>
<p><code>Description</code>: An optional description for the connection.</p>
</li>
<li>
<p><code>Endpoint</code>: Get the URL for the Instana Endpoint from the <em>Lab Parameters Table</em>.</p>
</li>
<li>
<p><code>API Token</code>: Get the API Token from the <em>Lab Parameters Table</em>.</p>
</li>
<li>
<p><code>Deployment options</code>: Select <code>local</code> (Note that it is possible to deploy an Instana conection gateway remotely, but in this lab we will deploy in the same <code>local</code> cluster).</p>
</li>
</ul>
<p>Click Next.</p>
<p>Enter the following <code>Collect topology data</code>:</p>
<ul>
<li>
<p><code>Enable data flow</code>: Set this toggle button to on (green).</p>
</li>
<li>
<p><code>Time window</code> (seconds): Leave as it is. This is the windowSize within the Instana API.</p>
</li>
<li>
<p><code>Connection Intervals</code> (seconds): Leave as it is. This is how frequently to run the job to collect topology.</p>
</li>
<li>
<p><code>Application name allowlist pattern</code>: This allows to select from the set of applications that Instana is "observing" which one we will pull data from. In this Lab, we will pull topology data from a single application called qotd. Type in <code>qotd</code>.</p>
</li>
<li>
<p><code>Import Instana application perspectives as Cloud Pak for Watson AIOps applications</code>: Make sure this toggle button is set to <code>on</code> (green). This option will save us some time as we don't need to manually create in CP4WAIOps an application that group the topology resources that we pull from Instana. In CP4WAIOps, an application represents a group of resources put together.</p>
</li>
</ul>
<p>Click Next.</p>
<p>Enter the following in <code>Collect event data</code>:</p>
<ul>
<li><code>Enable data flow</code>: Slide this toggle button to off (grey). We will not collect event data in this Lab.</li>
</ul>
<p>Click Next.</p>
<p>Enter the following in <code>Collect metric data</code>:</p>
<ul>
<li><code>Enable data flow</code>: Slide this toggle button to off (grey). We will not collect metric data in this Lab.</li>
</ul>
<p>Click Done. </p>
<p>Now, lets verify that CP4WAIOps actually received topology data.</p>
<p>From the Home page, clik on Resource management under Overview on the left side of the page. On the Resource management page, you will see a new application defined called <code>qotd</code> as shown below:</p>
<p><img alt="Resource management" src="../images/resource-mgmt.png" title="Resource management" /></p>
<p>Click on the application <code>qotd</code> and you will see the topology resources related to this application as shown in the picture below. Feel free to zoom-in to see details.</p>
<p><img alt="qotd Topology" src="../images/resource-topo.png" title="qotd Topology]" /></p>
<hr />
<h2 id="review-and-update-cp4waiops-policies">Review and Update CP4WAIOps Policies</h2>
<p>Now, lets take a look at the automations page in CP4WAIOps. By creating automations, we can proactively set up actions and policies to detect and remediate events. </p>
<p>From the Home page, clik on <code>Automations</code> under <code>Overview</code> on the left side of the page. In this page, we can manage <em>Policies</em>, <em>Runbooks</em> and <em>Actions</em> (we will see Stories later in the Inference section of the Lab)</p>
<p>Under the <em>Policies</em> tab, we can see a list of system predefined policies that support a number of features in CP4WAIOps. We will review and enable a predefined policy that create stories:</p>
<ul>
<li>
<p>Click on the Tag pull down filter and select <code>Story</code> to only show the Story related policies.</p>
</li>
<li>
<p>Change the state of the <code>Default story creation policy for all alerts</code> policy from Disabled to Enabled by clicking on the State slider. We need to enable this policy so we can see stories being created later in the Inference section of the Lab.</p>
</li>
<li>
<p>This Policy will basically create a new Story for every new Alert regardless of the severity of the Alert. Click on the policy name to see the policy details on the right of the page. </p>
</li>
<li>
<p>Click on the <code>Journal</code> tab to see the updates done so far to this policy.</p>
</li>
<li>
<p>Click on the <code>Specification</code> tab to see the actual steps or logic of the policy.</p>
</li>
</ul>
<p>That's all we need to do to enable this policy. </p>
<hr />
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../log-anomaly/" class="btn btn-neutral float-right" title="Log Anomaly Training">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="../log-anomaly/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
